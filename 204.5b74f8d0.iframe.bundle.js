(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{4285:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var react=__webpack_require__(1),react_default=__webpack_require__.n(react),prop_types=__webpack_require__(2),prop_types_default=__webpack_require__.n(prop_types),es=__webpack_require__(75),lib=__webpack_require__(17),classnames=__webpack_require__(22),classnames_default=__webpack_require__.n(classnames),withStyles=__webpack_require__(26),withStyles_default=__webpack_require__.n(withStyles),LinkLocalized=__webpack_require__(4090),localization=__webpack_require__(6),mobileDetect=__webpack_require__(137),SessionService=__webpack_require__(56),login_const=__webpack_require__(46),Button=__webpack_require__(41),social_login=__webpack_require__(4257),social_login_default=__webpack_require__.n(social_login),URLBuilder=__webpack_require__(5),jsx_runtime=__webpack_require__(0);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function getURL(_ref){var clientId=_ref.clientId,scope=_ref.scope,_ref$state=_ref.state,state=void 0===_ref$state?encodeURIComponent(window.location.pathname+window.location.search):_ref$state,redirect=encodeURIComponent(Object(URLBuilder.g)("/vk")),display=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent)?"touch":"page",fullScope=scope&&scope.length?"&scope=".concat(encodeURIComponent(scope)):"";return"".concat("https://oauth.vk.com/authorize?response_type=code","&client_id=").concat(clientId,"&redirect_uri=").concat(redirect,"&display=").concat(display,"&state=").concat(state).concat(fullScope)}var VkLogin_VkLogin=function(_React$Component){!function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(VkLogin,_React$Component);var _super=_createSuper(VkLogin);function VkLogin(){var _this;_classCallCheck(this,VkLogin);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _defineProperty(_assertThisInitialized(_this=_super.call.apply(_super,[this].concat(args))),"start",(function(){var clientId=_this.props.apiId;window.location.href=getURL({clientId:clientId,scope:"email",state:_this.props.state})})),_this}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(VkLogin,[{key:"render",value:function render(){var _this$props=this.props,disabled=_this$props.disabled,children=(_this$props.apiId,_this$props.children),buttonProps=_objectWithoutProperties(_this$props,["disabled","apiId","children"]);return Object(jsx_runtime.jsx)(Button.c,_objectSpread(_objectSpread({disabled:disabled,onClick:this.start},buttonProps),{},{children:children}))}}]),VkLogin}(react_default.a.Component);_defineProperty(VkLogin_VkLogin,"propTypes",{disabled:prop_types_default.a.bool,callback:prop_types_default.a.func,apiId:prop_types_default.a.string.isRequired,children:prop_types_default.a.any,state:prop_types_default.a.string}),VkLogin_VkLogin.__docgenInfo={description:"",methods:[{name:"start",docblock:null,modifiers:[],params:[],returns:null}],displayName:"VkLogin",props:{disabled:{type:{name:"bool"},required:!1,description:""},callback:{type:{name:"func"},required:!1,description:""},apiId:{type:{name:"string"},required:!0,description:""},children:{type:{name:"any"},required:!1,description:""},state:{type:{name:"string"},required:!1,description:""}}};var SocialLogin_VkLogin=VkLogin_VkLogin;function SocialLoginButton_typeof(obj){return(SocialLoginButton_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function SocialLoginButton_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function SocialLoginButton_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function SocialLoginButton_setPrototypeOf(o,p){return(SocialLoginButton_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function SocialLoginButton_createSuper(Derived){var hasNativeReflectConstruct=function SocialLoginButton_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=SocialLoginButton_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=SocialLoginButton_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return SocialLoginButton_possibleConstructorReturn(this,result)}}function SocialLoginButton_possibleConstructorReturn(self,call){return!call||"object"!==SocialLoginButton_typeof(call)&&"function"!=typeof call?function SocialLoginButton_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function SocialLoginButton_getPrototypeOf(o){return(SocialLoginButton_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function SocialLoginButton_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function SocialLoginButton_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?SocialLoginButton_ownKeys(Object(source),!0).forEach((function(key){SocialLoginButton_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):SocialLoginButton_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function SocialLoginButton_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function SocialLoginButton_objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function SocialLoginButton_objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}var SocialLoginButton=social_login_default()((function(_ref){var children=_ref.children,triggerLogin=_ref.triggerLogin,props=SocialLoginButton_objectWithoutProperties(_ref,["children","triggerLogin"]);return Object(jsx_runtime.jsx)(Button.c,SocialLoginButton_objectSpread(SocialLoginButton_objectSpread({onClick:triggerLogin},props),{},{children:children}))})),SocialLoginButton_createLoginButton=function createLoginButton(provider,appId,content){return function(_React$Component){!function SocialLoginButton_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SocialLoginButton_setPrototypeOf(subClass,superClass)}(SocialLoginButtonImpl,_React$Component);var _super=SocialLoginButton_createSuper(SocialLoginButtonImpl);function SocialLoginButtonImpl(){return SocialLoginButton_classCallCheck(this,SocialLoginButtonImpl),_super.apply(this,arguments)}return function SocialLoginButton_createClass(Constructor,protoProps,staticProps){return protoProps&&SocialLoginButton_defineProperties(Constructor.prototype,protoProps),staticProps&&SocialLoginButton_defineProperties(Constructor,staticProps),Constructor}(SocialLoginButtonImpl,[{key:"render",value:function render(){var _this=this,_this$props=this.props,onLoginSuccess=_this$props.onLoginSuccess,otherProps=SocialLoginButton_objectWithoutProperties(_this$props,["onLoginSuccess"]);return Object(jsx_runtime.jsx)(SocialLoginButton,SocialLoginButton_objectSpread(SocialLoginButton_objectSpread({provider:provider,appId:appId,onLoginSuccess:onLoginSuccess,onLoginFailure:function onLoginFailure(){return _this.forceUpdate()}},otherProps),{},{children:content}),Math.random())}}]),SocialLoginButtonImpl}(react_default.a.Component)},GoogleLoginButton=(SocialLoginButton_createLoginButton("facebook","166163670680673",Object(jsx_runtime.jsx)("i",{className:"fa fa-facebook"})),SocialLoginButton_createLoginButton("google","367836819613-u0ipgaq4ojck87qv77llnphcnn4jba8f.apps.googleusercontent.com",Object(jsx_runtime.jsx)("i",{className:"fa fa-google"}))),SocialLoginButton_VkLoginButton=function VkLoginButton(props){return Object(jsx_runtime.jsx)(SocialLogin_VkLogin,SocialLoginButton_objectSpread(SocialLoginButton_objectSpread({apiId:"6370789"},props),{},{children:Object(jsx_runtime.jsx)("i",{className:"fa fa-vk"})}))};SocialLoginButton_VkLoginButton.__docgenInfo={description:"",methods:[],displayName:"VkLoginButton"};var MagicActionsService=__webpack_require__(4100),UserProfileValidators=__webpack_require__(4091),auth=__webpack_require__(4092),error_codes=__webpack_require__(459),Input=__webpack_require__(1029),auth_auth=__webpack_require__(4093),auth_default=__webpack_require__.n(auth_auth),login=__webpack_require__(4094),login_default=__webpack_require__.n(login),CircleProgress=__webpack_require__(4095),debounce_decorator=__webpack_require__(4096),MaterialCheckbox=__webpack_require__(498),miscUtils=__webpack_require__(9),PhoneInput=__webpack_require__(4097),loginServiceActions=__webpack_require__(88),authentication_const=__webpack_require__(1022),GuestMagicLinkAPI=__webpack_require__(499),modals_const=__webpack_require__(98),CommunityInvitationModal_const=__webpack_require__(4098),auth_const=__webpack_require__(1473),community_const=__webpack_require__(239),UserWorkspacesService=__webpack_require__(381);__webpack_require__(194),__webpack_require__(21),__webpack_require__(829),__webpack_require__(462);function SignInForm_typeof(obj){return(SignInForm_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function SignInForm_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function SignInForm_setPrototypeOf(o,p){return(SignInForm_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function SignInForm_createSuper(Derived){var hasNativeReflectConstruct=function SignInForm_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=SignInForm_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=SignInForm_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return SignInForm_possibleConstructorReturn(this,result)}}function SignInForm_possibleConstructorReturn(self,call){return!call||"object"!==SignInForm_typeof(call)&&"function"!=typeof call?SignInForm_assertThisInitialized(self):call}function SignInForm_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function SignInForm_getPrototypeOf(o){return(SignInForm_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function SignInForm_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var SignInForm_ErrorMessage=function ErrorMessage(_ref){var message=_ref.message;return Object(jsx_runtime.jsx)("div",{className:auth_default.a.errorMessage,"data-xpath":"error_msg",children:message})};SignInForm_ErrorMessage.propTypes={message:prop_types_default.a.string};var SignInForm_SignInForm=function(_Component){!function SignInForm_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&SignInForm_setPrototypeOf(subClass,superClass)}(SignInForm,_Component);var _onSubmitPass,_resetPass,_loginWithoutPass,_onSubmitCheckPinCode,_onSubmitMail,_resendEmail,_super=SignInForm_createSuper(SignInForm);function SignInForm(props,context){var _this;return function SignInForm_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SignInForm),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this=_super.call(this,props,context)),"phone",null),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"checkExistingUser",Object(debounce_decorator.a)(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(id){var signInType;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return signInType=_this.props.signInType,_context.next=3,_this.loginService.checkIfUserExistsUniversal(id);case 3:if(_context.sent){_context.next=12;break}if(signInType!==login_const.e.EMAIL||_this.state.errors.email!==Object(localization.a)("errors","NOT_FOUND_USER")){_context.next=9;break}return _context.abrupt("return");case 9:if(signInType!==login_const.e.EMAIL||_this.state.errors.phone!==Object(localization.a)("errors","NOT_FOUND_USER")){_context.next=11;break}return _context.abrupt("return");case 11:_this.setState(_this.createErrorState(signInType===login_const.e.EMAIL?"email":signInType===login_const.e.PHONE?"phone":"",Object(localization.a)("errors","NOT_FOUND_USER")));case 12:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref2.apply(this,arguments)}}())),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"onChangePassword",(function(password){_this.setState({password:password})})),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"onChangeNickname",(function(nickname){_this.setState({nickname:nickname}),_this.state.errors.nickname&&_this.setState(_this.createErrorState("nickname",null))})),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"setResendTimeout",(function(){_this.setState({resendAllowed:!1,resendTime:Date.now()}),_this.resendTimeout=setTimeout((function(){_this.setState({resendAllowed:!0,resendTimeoutProgress:null}),_this.resendTimer&&clearInterval(_this.resendTimer)}),auth_const.b),_this.resendTimer=setInterval((function(){var resendTimeoutProgress=(Date.now()-_this.state.resendTime)/auth_const.b*100;_this.setState({resendTimeoutProgress:resendTimeoutProgress})}),1e3)})),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"outAuth",_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var _this$props,isModal,backUrl,guest,backAction,magicKey,magicLinkKey,communityInvite,response,roomUuids,backUrlCommunityInvite,i,redirect,backActionPromise;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(_this$props=_this.props,isModal=_this$props.isModal,backUrl=_this$props.backUrl,guest=_this$props.guest,backAction=_this$props.backAction,magicKey=_this$props.magicKey,magicLinkKey=_this$props.magicLinkKey,_this.props.setAuthMode(login_const.a.SIGN_IN),_this.props.setAuthAllowedMods([login_const.a.SIGN_IN,login_const.a.SIGN_UP]),isModal&&(_this.modalService.isShown(CommunityInvitationModal_const.a)&&_this.modalService.hide(CommunityInvitationModal_const.a),_this.modalService.hide(authentication_const.a),_this.props.setAuthModalMode(!1)),!guest||!magicKey){_context2.next=8;break}_this.guestMagicLinkAPI.execute(magicKey,{username:"",firstName:""}).then((function(){_this.communitiesService.init(),_this.userWorkspaceService.getMyWorkspaces(),_this.history.replace(backUrl),_this.props.setAuthGuest(!1)})).catch((function(error){console.error(error)})),_context2.next=18;break;case 8:if(!magicLinkKey){_context2.next=17;break}return communityInvite=null,_context2.next=12,_this.guestMagicLinkAPI.getKeyInfo(magicLinkKey);case 12:if((response=_context2.sent)&&response.isCommunityInvite){for(roomUuids=[],backUrlCommunityInvite="/",i=0;i<response.actions.length;i++)"GUEST"===response.actions[i].type&&response.actions[i].workspaceUUID&&roomUuids.push(response.actions[i].workspaceUUID),"REDIRECT"===response.actions[i].type&&(redirect=response.actions[i].url,backUrlCommunityInvite=redirect&&redirect.includes("https://dev.acroplia.com")?redirect.replace("https://dev.acroplia.com",""):redirect&&redirect.includes("https://acroplia.com")?redirect.replace("https://acroplia.com",""):redirect);communityInvite={communityUUID:response.communityUUID,backUrlCommunityInvite:backUrlCommunityInvite,roomUuids:roomUuids}}_this.magicActions.confirm(magicLinkKey,communityInvite),_context2.next=18;break;case 17:backAction?null==(backActionPromise=backAction())||backActionPromise.then((function(){backUrl&&_this.history.replace(backUrl)})):backUrl&&_this.history.replace(backUrl);case 18:case"end":return _context2.stop()}}),_callee2)})))),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"checkExtraOptions",(function(){var email=_this.state.email,_this$props2=_this.props,signInType=_this$props2.signInType,phone=_this$props2.phone,validateEmailResult=_this.validateEmail(email),validatePhoneResult=_this.validatePhone(phone);return signInType!==login_const.e.EMAIL||validateEmailResult?!(signInType===login_const.e.PHONE&&!validatePhoneResult)||(_this.setState({errors:_this.createErrorState("phone",Object(localization.a)("dialogs","phone_number_is_invalid")).errors,step:auth_const.c.ENTER_MAIL}),!1):(_this.setState({errors:_this.createErrorState("email",Object(localization.a)("errors","INVALID_EMAIL_FORMAT")).errors,step:auth_const.c.ENTER_MAIL}),!1)})),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"checkRenderExtra",(function(){return _this.signInType===login_const.e.EMAIL||_this.signInType===login_const.e.PHONE})),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"goToPrevStep",(function(){_this.props.setAuthAllowedMods([login_const.a.SIGN_IN,login_const.a.SIGN_UP]),_this.setState({step:auth_const.c.ENTER_MAIL,password:_this.props.password})})),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"createGuestAccount",function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var _this$state,nickname,iAgreeToTheTermsOfUse,_this$props3,guest,magicKey,backUrl,errorMessage,response;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(e&&e.preventDefault(),_this$state=_this.state,nickname=_this$state.nickname,iAgreeToTheTermsOfUse=_this$state.iAgreeToTheTermsOfUse,_this$props3=_this.props,guest=_this$props3.guest,magicKey=_this$props3.magicKey,backUrl=_this$props3.backUrl,errorMessage=null,!(nickname&&nickname.length>0&&nickname.replace(/[\s\-()]/g,"").length>0&&iAgreeToTheTermsOfUse)){_context3.next=15;break}return _this.setState({isBusy:!0,errors:_this.getDefaultErrorState()}),_context3.next=8,_this.loginService.createGuestAccount(nickname,guest,magicKey,backUrl);case 8:null!=(response=_context3.sent)&&response.data&&(sessionStorage.setItem("nickname",nickname),sessionStorage.setItem("guestUuid",response.data.uuid)),null!=response&&response.error&&response.error.codes&&response.error.codes.includes("CONFLICT_USERNAME_ALREADY_REGISTERED")&&(errorMessage="This name already exists."),_this.setState({isBusy:!1}),_this.props.setAuthGuest(!1),_context3.next=16;break;case 15:errorMessage="Enter a nickname";case 16:_this.setState(_this.createErrorState("nickname",errorMessage));case 17:case"end":return _context3.stop()}}),_callee3)})));return function(_x2){return _ref4.apply(this,arguments)}}()),SignInForm_defineProperty(SignInForm_assertThisInitialized(_this),"getSubtext",(function(){var _this$props4=_this.props,phone=_this$props4.phone,email=_this$props4.email;switch(_this.signInType){case login_const.e.PHONE:return phone;case login_const.e.EMAIL:return email;default:return""}})),_this.state={step:_this.props.step,email:props.email,phone:props.phone,password:_this.props.password,nickname:"",iAgreeToTheTermsOfUse:!1,isBusy:!1,errors:_this.getDefaultErrorState(),enterPassCount:0,resendAllowed:!1,accounts:[]},_this.textInput=react_default.a.createRef(),_this.inputEmail=react_default.a.createRef(),_this.inputPinCode=react_default.a.createRef(),_this.onSubmitMail=_this.onSubmitMail.bind(SignInForm_assertThisInitialized(_this)),_this.onSubmitPass=_this.onSubmitPass.bind(SignInForm_assertThisInitialized(_this)),_this.onSubmitCheckPinCode=_this.onSubmitCheckPinCode.bind(SignInForm_assertThisInitialized(_this)),_this.loginService=context.beansContext.getBeanInstance(login_const.c),_this.magicActions=context.beansContext.getBeanInstance(MagicActionsService.a),_this.guestMagicLinkAPI=context.beansContext.getBeanInstance(GuestMagicLinkAPI.a),_this.modalService=context.beansContext.getBeanInstance(modals_const.a),_this.history=context.beansContext.getBeanInstance("history"),_this.communitiesService=context.beansContext.getBeanInstance(community_const.a),_this.userWorkspaceService=context.beansContext.getBeanInstance(UserWorkspacesService.a),_this.onChangeEmail=auth.d.bind(SignInForm_assertThisInitialized(_this)),_this.onBlurEmail=auth.b.bind(SignInForm_assertThisInitialized(_this)),_this.onChangePhone=auth.e.bind(SignInForm_assertThisInitialized(_this)),_this.onBlurPhone=auth.c.bind(SignInForm_assertThisInitialized(_this)),_this}return function SignInForm_createClass(Constructor,protoProps,staticProps){return protoProps&&SignInForm_defineProperties(Constructor.prototype,protoProps),staticProps&&SignInForm_defineProperties(Constructor,staticProps),Constructor}(SignInForm,[{key:"componentDidMount",value:function componentDidMount(){var _this$state2=this.state,email=_this$state2.email,phone=_this$state2.phone,signInType=this.props.signInType;signInType===login_const.e.EMAIL&&""!==email?this.validateEmail(email)?this.checkExistingUser(email):this.setState(this.createErrorState("email",Object(localization.a)("errors","INVALID_EMAIL_FORMAT"))):signInType===login_const.e.PHONE&&""!==phone&&this.checkExistingUser(phone)}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.state.step===auth_const.c.CHECK_PIN_CODE&&void 0===this.state.resendTime&&this.setResendTimeout()}},{key:"componentWillUnmount",value:function componentWillUnmount(){null!=this.phone&&this.props.setAuthPhone(this.phone)}},{key:"resendEmail",value:(_resendEmail=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:this.setState({resending:!0}),this.loginWithoutPass()&&this.setState({resending:!1}),this.setResendTimeout();case 4:case"end":return _context4.stop()}}),_callee4,this)}))),function resendEmail(){return _resendEmail.apply(this,arguments)})},{key:"getDefaultErrorState",value:function getDefaultErrorState(){return{email:"",phone:"",password:"",nickname:""}}},{key:"createErrorState",value:function createErrorState(field,error){var errors=Object.assign({},this.state.errors);return errors[field]=error,{errors:errors}}},{key:"validateEmail",value:function validateEmail(email){return{isValid:Object(UserProfileValidators.b)(email).isValid}}},{key:"validatePhone",value:function validatePhone(phone){return Object(UserProfileValidators.c)(phone).isValid}},{key:"onSubmitMail",value:(_onSubmitMail=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(e){var email,_this$props5,signInType,phone,username,validateEmailResult,validatePhoneResult,result;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(e&&e.preventDefault(),email=this.state.email,_this$props5=this.props,signInType=_this$props5.signInType,phone=_this$props5.phone,username=_this$props5.username,validateEmailResult=this.validateEmail(email),validatePhoneResult=this.validatePhone(phone),signInType!==login_const.e.PHONE||!validatePhoneResult){_context5.next=10;break}this.signInType=login_const.e.PHONE,this.props.setAuthPhone(phone),_context5.next=17;break;case 10:if(signInType!==login_const.e.EMAIL||!validateEmailResult){_context5.next=15;break}this.signInType=login_const.e.EMAIL,this.props.setAuthEmail(email),_context5.next=17;break;case 15:return this.setState(this.createErrorState("email",Object(localization.a)("errors","INVALID_EMAIL_FORMAT"))),_context5.abrupt("return");case 17:return this.props.setAuthSignInType(this.signInType),this.setState({isBusy:!0,errors:this.getDefaultErrorState()}),_context5.next=21,this.loginService.checkUser(email,phone,username,signInType);case 21:(result=_context5.sent).error?this.setState(this.createErrorState(signInType===login_const.e.EMAIL?"email":signInType===login_const.e.PHONE?"phone":"",result.error.codes&&result.error.codes.some((function(er){return"NOT_FOUND_USER"==er}))?Object(localization.a)("errors","NOT_FOUND_USER"):Object(localization.a)("errors",error_codes.a.INVALID_EMAIL_FORMAT))):result.userInfo&&(result.name&&this.props.setAuthName(result.name),this.props.setAuthAllowedMods([login_const.a.SIGN_IN]),this.setState({step:auth_const.c.ENTER_PASS})),this.setState({isBusy:!1});case 24:case"end":return _context5.stop()}}),_callee5,this)}))),function onSubmitMail(_x3){return _onSubmitMail.apply(this,arguments)})},{key:"onSubmitCheckPinCode",value:(_onSubmitCheckPinCode=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(el){var signInType,email,phone,pinCode;return regeneratorRuntime.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return el&&el.preventDefault(),this.setState({busy:!0}),(signInType=this.props.signInType)===login_const.e.EMAIL?email=this.props.email:signInType===login_const.e.PHONE&&(phone=this.props.phone),pinCode=this.inputPinCode.current.value,_context6.prev=5,_context6.next=8,this.magicActions.confirmByPin(email,phone,pinCode);case 8:if(!this.props.loginWithoutPass){_context6.next=13;break}return this.modalService.hide(authentication_const.a),_context6.next=12,SessionService.a.refreshSession(Object(URLBuilder.a)("v1/users/".concat(this.props.session.getIn(["user","uuid"]))));case 12:this.props.setLoginServiceState({loginWithoutPass:!1});case 13:this.outAuth(),_context6.next=19;break;case 16:_context6.prev=16,_context6.t0=_context6.catch(5),this.setState(this.createErrorState("pincode","wrong_code"));case 19:this.setState({busy:!1});case 20:case"end":return _context6.stop()}}),_callee6,this,[[5,16]])}))),function onSubmitCheckPinCode(_x4){return _onSubmitCheckPinCode.apply(this,arguments)})},{key:"loginWithoutPass",value:(_loginWithoutPass=_asyncToGenerator(regeneratorRuntime.mark((function _callee7(){var _this$props6,email,phone,username,signInType,backUrl,magicLinkKey;return regeneratorRuntime.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(!this.checkExtraOptions()){_context7.next=7;break}return _this$props6=this.props,email=_this$props6.email,phone=_this$props6.phone,username=_this$props6.username,signInType=_this$props6.signInType,backUrl=_this$props6.backUrl,magicLinkKey=_this$props6.magicLinkKey,_context7.next=4,this.loginService.loginWithoutPass(email,phone,username,signInType,backUrl,magicLinkKey);case 4:_context7.sent&&this.props.setLoginServiceState({loginWithoutPass:!0}),this.setState({step:auth_const.c.CHECK_PIN_CODE});case 7:case"end":return _context7.stop()}}),_callee7,this)}))),function loginWithoutPass(){return _loginWithoutPass.apply(this,arguments)})},{key:"resetPass",value:(_resetPass=_asyncToGenerator(regeneratorRuntime.mark((function _callee8(){var _this$props7,email,phone,username,signInType,signUpAllowed,magicLinkKey,guest,_this3=this;return regeneratorRuntime.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(this.checkExtraOptions()){_context8.next=2;break}return _context8.abrupt("return");case 2:_this$props7=this.props,email=_this$props7.email,phone=_this$props7.phone,username=_this$props7.username,signInType=_this$props7.signInType,signUpAllowed=_this$props7.signUpAllowed,magicLinkKey=_this$props7.magicLinkKey,guest=_this$props7.guest,this.loginService.resetPass(email,phone,username,signInType,"/",magicLinkKey).then((function(){var patch={notificationMessage:Object(localization.a)("dialogs","click_link_to_change_pass"),checkSpamFolderMessage:Object(localization.a)("dialogs","check_spam_email"),allowedMods:[login_const.a.NOTIFICATION]};guest||(patch.backUrl="/"),signUpAllowed&&(patch.mode=login_const.a.NOTIFICATION),_this3.props.setLoginServiceState(patch)})).catch((function(error){console.error(error)}));case 5:case"end":return _context8.stop()}}),_callee8,this)}))),function resetPass(){return _resetPass.apply(this,arguments)})},{key:"renderErrorPasswordSuggestion",value:function renderErrorPasswordSuggestion(){var _this4=this;if(!this.checkRenderExtra())return null;var signInType=this.props.signInType;return Object(jsx_runtime.jsxs)("span",{children:[Object(jsx_runtime.jsx)(LinkLocalized.a,{text:Object(localization.a)("dialogs","invalid_password_with_suggesting"),click:function click(){return _this4.loginWithoutPass()}}),signInType!==login_const.e.PHONE&&Object(jsx_runtime.jsx)(LinkLocalized.a,{text:Object(localization.a)("dialogs","invalid_password_with_suggesting_after"),click:function click(){return _this4.resetPass()}})]})}},{key:"onSubmitPass",value:(_onSubmitPass=_asyncToGenerator(regeneratorRuntime.mark((function _callee9(e){var password,_this$props8,email,username,phone,signInType,errorMessage,result;return regeneratorRuntime.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(e&&e.preventDefault(),password=this.state.password,_this$props8=this.props,email=_this$props8.email,username=_this$props8.username,phone=_this$props8.phone,signInType=_this$props8.signInType,errorMessage=null,!(password&&password.length>0)){_context9.next=14;break}return this.props.setAuthPassword(password),this.setState({isBusy:!0,errors:this.getDefaultErrorState(),enterPassCount:this.state.enterPassCount+1}),_context9.next=9,this.loginService.signIn(email,username,signInType,phone,password);case 9:(result=_context9.sent).error?(errorMessage=Object(localization.a)("dialogs","invalid_password"),this.state.enterPassCount>=auth_const.e&&(errorMessage=this.renderErrorPasswordSuggestion())):result.signIn&&this.outAuth(),this.setState({isBusy:!1}),_context9.next=15;break;case 14:errorMessage=Object(localization.a)("dialogs","invalid_password");case 15:this.setState(this.createErrorState("password",errorMessage));case 16:case"end":return _context9.stop()}}),_callee9,this)}))),function onSubmitPass(_x5){return _onSubmitPass.apply(this,arguments)})},{key:"renderEnterEmailStep",value:function renderEnterEmailStep(){var _this5=this,email=this.state.email,_this$props9=this.props,signInType=_this$props9.signInType,phone=_this$props9.phone;return Object(jsx_runtime.jsx)("div",{className:auth_default.a.root,children:Object(jsx_runtime.jsx)("div",{className:auth_default.a.container,children:Object(jsx_runtime.jsxs)("form",{onSubmit:this.onSubmitMail,className:auth_default.a.form,ref:function ref(form){_this5.formAuthMail=form},children:[signInType===login_const.e.PHONE&&Object(jsx_runtime.jsx)("input",{name:"email",autoComplete:"username",style:{display:"none"}}),signInType===login_const.e.EMAIL?Object(jsx_runtime.jsxs)("div",{className:auth_default.a.fieldBlock,children:[Object(jsx_runtime.jsxs)("div",{className:classnames_default()(auth_default.a.label,auth_default.a.emailOrPhone),children:[Object(jsx_runtime.jsx)("span",{children:Object(localization.a)("dialogs","email_placeholder")}),Object(jsx_runtime.jsx)("span",{style:{flex:1}}),Object(jsx_runtime.jsx)("a",{onClick:function onClick(){return _this5.props.setAuthSignInType(login_const.e.PHONE)},"data-test-id":"byPhone",children:Object(localization.a)("dialogs","by_phone_number")})]}),Object(jsx_runtime.jsx)(Input.a,{inputRef:this.inputEmail,autoFocus:!mobileDetect.a.isMobile(),className:classnames_default()(auth_default.a.input,auth_default.a.email),isAutoFocus:!mobileDetect.a.isMobile(),placeholder:"".concat(Object(localization.a)("profile","write_here_placeholder")),autoComplete:"username",type:"text",name:"email",maxLength:100,value:email,tabIndex:0,onChange:function onChange(e){return _this5.onChangeEmail(e.target.value)},onBlur:function onBlur(e){return _this5.onBlurEmail(e.target.value)}}),this.state.errors.email&&Object(jsx_runtime.jsx)(SignInForm_ErrorMessage,{message:this.state.errors.email})]}):Object(jsx_runtime.jsxs)("div",{className:auth_default.a.fieldBlock,children:[Object(jsx_runtime.jsxs)("div",{className:classnames_default()(auth_default.a.label,auth_default.a.emailOrPhone),children:[Object(jsx_runtime.jsx)("span",{children:Object(localization.a)("dialogs","phone_number")}),Object(jsx_runtime.jsx)("span",{style:{flex:1}}),Object(jsx_runtime.jsx)("a",{onClick:function onClick(){return _this5.props.setAuthSignInType(login_const.e.EMAIL)},children:Object(localization.a)("dialogs","by_email")})]}),Object(jsx_runtime.jsx)(PhoneInput.a,{autoFocus:!mobileDetect.a.isMobile(),value:phone,tabIndex:0,onChange:this.onChangePhone,onBlur:this.onBlurPhone}),this.state.errors.phone&&Object(jsx_runtime.jsx)(SignInForm_ErrorMessage,{message:this.state.errors.phone})]}),Object(jsx_runtime.jsx)("input",{id:"password",type:"password",name:"password",autoComplete:"current-password","aria-hidden":"true",tabIndex:"-1",style:{position:"absolute",opacity:0},onChange:miscUtils.t}),!1,Object(jsx_runtime.jsx)("div",{className:auth_default.a.buttonRegister,children:Object(jsx_runtime.jsxs)(Button.c,{type:Button.b.primary,size:Button.a.medium,disabled:this.state.isBusy,tabIndex:0,onClick:this.onSubmitMail,"data-test-id":"signin_next",children:[this.state.isBusy&&Object(jsx_runtime.jsx)("i",{className:"fa fa-spinner fa-spin"}),Object(localization.a)("dialogs","sign_in_next")]})}),Object(jsx_runtime.jsx)("button",{type:"submit",style:{position:"absolute",visibility:"hidden"}}),Object(jsx_runtime.jsx)("div",{className:"text-center",children:Object(jsx_runtime.jsxs)(react_default.a.Fragment,{children:[Object(jsx_runtime.jsx)(GoogleLoginButton,{onLoginSuccess:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee10(resp){return regeneratorRuntime.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,SessionService.a.signInBySocial("google",resp._token.idToken);case 2:_this5.outAuth();case 3:case"end":return _context10.stop()}}),_callee10)})));return function(_x6){return _ref5.apply(this,arguments)}}()}),Object(jsx_runtime.jsx)(SocialLoginButton_VkLoginButton,{state:encodeURIComponent(this.props.backUrl)})]})}),this.props.guest&&Object(jsx_runtime.jsx)("div",{className:auth_default.a.continueAsGuest,children:Object(jsx_runtime.jsx)("span",{onClick:function onClick(){return _this5.setState({step:auth_const.c.GUEST})},children:Object(localization.a)("dialogs","continue_as_guest")})})]})})})}},{key:"renderEnterPasswordStep",value:function renderEnterPasswordStep(){var _this6=this,password=this.state.password,signInType=this.props.signInType,emailOrPhoneText=this.getSubtext();return Object(jsx_runtime.jsx)("div",{className:auth_default.a.root,children:Object(jsx_runtime.jsx)("div",{className:auth_default.a.container,children:Object(jsx_runtime.jsxs)("form",{onSubmit:this.onSubmitPass,className:auth_default.a.form,ref:function ref(form){_this6.formAuthPass=form},children:[signInType===login_const.e.EMAIL?Object(jsx_runtime.jsx)("input",{value:this.props.email,type:"email",name:"email",autoComplete:"off","aria-hidden":"true",tabIndex:"-1",style:{position:"absolute",opacity:0,visibility:"hidden"},onChange:miscUtils.t}):Object(jsx_runtime.jsx)("input",{value:this.props.phone,name:"phone",autoComplete:"off","aria-hidden":"true",tabIndex:"-1",style:{position:"absolute",opacity:0,visibility:"hidden"},onChange:miscUtils.t}),Object(jsx_runtime.jsx)("div",{className:auth_default.a.buttonRegister,children:Object(jsx_runtime.jsxs)("div",{className:"message",children:[Object(jsx_runtime.jsx)("span",{className:"back-arrow",onClick:this.goToPrevStep,children:Object(jsx_runtime.jsx)("i",{className:"fa fa-arrow-left"})}),Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("span",{children:[Object(localization.a)("dialogs","hi"),", ",this.props.name]}),Object(jsx_runtime.jsx)("span",{className:"email-text",children:emailOrPhoneText})]})]})}),Object(jsx_runtime.jsxs)("div",{className:auth_default.a.fieldBlock,children:[Object(jsx_runtime.jsx)(Input.a,{inputRef:this.textInput,className:auth_default.a.input,isAutoFocus:!mobileDetect.a.isMobile(),autoFocus:!mobileDetect.a.isMobile(),placeholder:"".concat(Object(localization.a)("dialogs","password_placeholder")),type:"password",name:"password",maxLength:50,value:password,onChange:function onChange(e){return _this6.onChangePassword(e.target.value)}}),this.state.errors.password&&Object(jsx_runtime.jsx)(SignInForm_ErrorMessage,{message:this.state.errors.password})]}),Object(jsx_runtime.jsxs)("div",{className:auth_default.a.buttonRegister,children:[Object(jsx_runtime.jsxs)(Button.c,{type:Button.b.primary,size:Button.a.medium,disabled:this.state.isBusy,onClick:function onClick(){return _this6.submitBtn.click()},"data-test-id":"signin_btn",children:[this.state.isBusy&&Object(jsx_runtime.jsx)("i",{className:"fa fa-spinner fa-spin"}),Object(localization.a)("dialogs","sign_in")]}),Object(jsx_runtime.jsx)("button",{type:"submit",ref:function ref(submitBtn){return _this6.submitBtn=submitBtn},style:{position:"absolute",visibility:"hidden"}}),this.checkRenderExtra()&&Object(jsx_runtime.jsxs)("div",{className:"form-group step-link",children:[Object(jsx_runtime.jsx)("span",{style:{display:"block",marginBottom:"2rem"},children:Object(jsx_runtime.jsx)("a",{onClick:function onClick(){return _this6.loginWithoutPass()},children:Object(localization.a)("dialogs","sign_in_without_pass")})}),this.signInType===login_const.e.EMAIL&&Object(jsx_runtime.jsx)("span",{style:{display:"block"},children:Object(jsx_runtime.jsx)("a",{onClick:function onClick(){return _this6.resetPass()},children:Object(localization.a)("dialogs","forgot_password_short")})})]})]})]})})})}},{key:"renderCheckPin",value:function renderCheckPin(resendAllowed,resendTimeoutProgress){var _this7=this,checkText=this.signInType===login_const.e.PHONE?Object(localization.a)("dialogs","check_your_phone"):Object(localization.a)("dialogs","check_your_email");return Object(jsx_runtime.jsxs)("form",{onSubmit:this.onSubmitCheckPinCode,className:"authentication-form check-pin-code-form text-center",children:[Object(jsx_runtime.jsxs)("div",{className:"message",children:[Object(jsx_runtime.jsx)("span",{className:"back-arrow",onClick:this.goToPrevStep,children:Object(jsx_runtime.jsx)("i",{className:"fa fa-arrow-left"})}),Object(jsx_runtime.jsxs)("span",{className:"",children:[checkText,":"]}),this.signInType===login_const.e.PHONE?Object(jsx_runtime.jsx)("span",{className:"email-text",children:this.props.phone}):Object(jsx_runtime.jsx)("span",{className:"email-text",children:this.props.email}),Object(jsx_runtime.jsx)("span",{className:"",children:Object(localization.a)("dialogs","enter_4d_pin_code")})]}),Object(jsx_runtime.jsxs)("div",{className:"form-group",children:[Object(jsx_runtime.jsx)(Input.a,{className:"pin-code"+(this.state.errors.pincode?" error":""),autoFocus:!mobileDetect.a.isMobile(),type:"tel",inputRef:this.inputPinCode,onChange:function onChange(key,value){var inputPinCode=_this7.inputPinCode.current;13!=key.which&&"Enter"!=key.key||inputPinCode.value.length<auth_const.a||_this7.state.busy?_this7.setState(_this7.createErrorState("pincode",null)):_this7.onSubmitCheckPinCode();var filtredStr=inputPinCode.value.replace(/[^0-9]/gim,"").substr(0,auth_const.a);inputPinCode.value=filtredStr,_this7.setState({pinCodeLength:inputPinCode.value.length})}}),this.state.errors.pincode&&Object(jsx_runtime.jsx)("span",{className:classnames_default()(login_default.a.pincodeErrorNew,"text-danger"),children:Object(localization.a)("dialogs","wrong_code")})]}),Object(jsx_runtime.jsxs)(Button.c,{type:Button.b.primary,size:Button.a.medium,disabled:this.state.busy||this.state.pinCodeLength<auth_const.a,onClick:this.onSubmitCheckPinCode,children:[this.state.busy&&Object(jsx_runtime.jsx)("i",{className:"fa fa-spinner fa-spin"}),Object(localization.a)("dialogs","confirm")]}),Object(jsx_runtime.jsxs)("div",{className:classnames_default()("form-group resend-link"),children:[!(this.signInType===login_const.e.PHONE)&&Object(jsx_runtime.jsx)("div",{style:{marginBottom:10},children:Object(jsx_runtime.jsxs)("span",{children:[Object(localization.a)("dialogs","check_spam_email")," ",Object(localization.a)("dialogs","or")]})}),Object(jsx_runtime.jsxs)("div",{className:classnames_default()(SignInForm_defineProperty({},auth_default.a.disabled,!resendAllowed)),children:[Object(jsx_runtime.jsx)(LinkLocalized.a,{text:Object(localization.a)("dialogs","resend_email"),click:function click(){return _this7.resendEmail()}}),resendTimeoutProgress&&Object(jsx_runtime.jsx)(CircleProgress.a,{className:auth_default.a.timer,progress:resendTimeoutProgress,size:16}),this.state.resending&&Object(jsx_runtime.jsx)("i",{className:"fa fa-spinner fa-spin"})]})]})]})}},{key:"renderGuest",value:function renderGuest(){var _this8=this,nickname=this.state.nickname;return Object(jsx_runtime.jsxs)("div",{className:auth_default.a.guest,children:[Object(jsx_runtime.jsx)("div",{className:auth_default.a.guest_title,children:Object(localization.a)("dialogs","temporary_guest_profile")}),Object(jsx_runtime.jsxs)("div",{className:auth_default.a.guest_form,children:[Object(jsx_runtime.jsxs)("div",{className:auth_default.a.guest_form_image_add_nickname,children:[Object(jsx_runtime.jsx)("span",{className:auth_default.a.guest_image,children:"G"}),Object(jsx_runtime.jsxs)("div",{className:auth_default.a.guest_add_nickname,children:[Object(jsx_runtime.jsx)("span",{children:Object(localization.a)("dialogs","add_a_nickname")}),Object(jsx_runtime.jsx)(Input.a,{className:auth_default.a.input,style:{margin:"2px 0",height:"36px"},placeholder:Object(localization.a)("dialogs","nickname"),maxLength:50,value:nickname,onChange:function onChange(e){return _this8.onChangeNickname(e.target.value)}})]})]}),this.state.errors.nickname&&Object(jsx_runtime.jsx)(SignInForm_ErrorMessage,{message:this.state.errors.nickname})]}),Object(jsx_runtime.jsxs)("div",{className:auth_default.a.terms_agreement,children:[Object(jsx_runtime.jsx)(MaterialCheckbox.b,{style:{marginTop:"14px"},checked:this.state.iAgreeToTheTermsOfUse,onChange:function onChange(e){return _this8.setState({iAgreeToTheTermsOfUse:!_this8.state.iAgreeToTheTermsOfUse})}}),Object(jsx_runtime.jsx)("span",{dangerouslySetInnerHTML:{__html:Object(localization.a)("dialogs","terms_agreement")}})]}),Object(jsx_runtime.jsxs)("div",{className:auth_default.a.guest_buttons,children:[Object(jsx_runtime.jsx)(Button.c,{type:Button.b.primary,className:auth_default.a.guests_back_button,style:{margin:"0 4px",textTransform:"none"},onClick:this.goToPrevStep,children:Object(localization.a)("browse","back")}),Object(jsx_runtime.jsxs)(Button.c,{type:Button.b.primary,style:{margin:"0 4px",textTransform:"none"},disabled:!this.state.iAgreeToTheTermsOfUse||!this.state.nickname||this.state.nickname&&!this.state.nickname.replace(/[\s\-()]/g,"").length||this.state.isBusy||this.state.errors.nickname,onClick:this.createGuestAccount,children:[Object(localization.a)("profile","lets_go"),"!"]})]})]})}},{key:"render",value:function render(){var _this$state3=this.state,step=_this$state3.step,resendAllowed=_this$state3.resendAllowed,resendTimeoutProgress=_this$state3.resendTimeoutProgress;return Object(jsx_runtime.jsxs)("div",{className:"sign-up","data-xpath":"sign-in-dlg",children:[step===auth_const.c.ENTER_MAIL&&this.renderEnterEmailStep(),step===auth_const.c.ENTER_PASS&&this.renderEnterPasswordStep(),step===auth_const.c.CHECK_PIN_CODE&&this.renderCheckPin(resendAllowed,resendTimeoutProgress),step===auth_const.c.GUEST&&this.renderGuest()]})}}]),SignInForm}(react.Component);SignInForm_defineProperty(SignInForm_SignInForm,"propTypes",{step:prop_types_default.a.string,email:prop_types_default.a.string,phone:prop_types_default.a.string,name:prop_types_default.a.string,username:prop_types_default.a.string,signInType:prop_types_default.a.oneOf([login_const.e.EMAIL,login_const.e.PHONE,login_const.e.USERNAME]),password:prop_types_default.a.string,backUrl:prop_types_default.a.string,backAction:prop_types_default.a.func,guest:prop_types_default.a.bool,magicKey:prop_types_default.a.string,magicLinkKey:prop_types_default.a.string,isModal:prop_types_default.a.bool,signUpAllowed:prop_types_default.a.bool,loginWithoutPass:prop_types_default.a.bool,session:prop_types_default.a.object,setAuthEmail:prop_types_default.a.func,setAuthPhone:prop_types_default.a.func,setAuthPassword:prop_types_default.a.func,setAuthAllowedMods:prop_types_default.a.func,setAuthSignInType:prop_types_default.a.func,setAuthMode:prop_types_default.a.func,setAuthModalMode:prop_types_default.a.func,setAuthGuest:prop_types_default.a.func,setLoginServiceState:prop_types_default.a.func,setAuthName:prop_types_default.a.func,inviteLink:prop_types_default.a.object}),SignInForm_defineProperty(SignInForm_SignInForm,"contextTypes",{history:prop_types_default.a.object,beansContext:prop_types_default.a.object}),SignInForm_defineProperty(SignInForm_SignInForm,"defaultProps",{step:auth_const.c.ENTER_MAIL}),SignInForm_SignInForm.__docgenInfo={description:"",methods:[{name:"onChangePassword",docblock:null,modifiers:[],params:[{name:"password",type:null}],returns:null},{name:"onChangeNickname",docblock:null,modifiers:[],params:[{name:"nickname",type:null}],returns:null},{name:"resendEmail",docblock:null,modifiers:["async"],params:[],returns:null},{name:"setResendTimeout",docblock:null,modifiers:[],params:[],returns:null},{name:"getDefaultErrorState",docblock:null,modifiers:[],params:[],returns:null},{name:"createErrorState",docblock:null,modifiers:[],params:[{name:"field",type:null},{name:"error",type:null}],returns:null},{name:"validateEmail",docblock:null,modifiers:[],params:[{name:"email",type:null}],returns:null},{name:"validatePhone",docblock:null,modifiers:[],params:[{name:"phone",type:null}],returns:null},{name:"outAuth",docblock:null,modifiers:["async"],params:[],returns:null},{name:"onSubmitMail",docblock:"TODO: Move determination and other type logic completely to login service from both sign in and sign up forms\nget rid of this.signInType, use service type instead",modifiers:["async"],params:[{name:"e"}],returns:null,description:"TODO: Move determination and other type logic completely to login service from both sign in and sign up forms\nget rid of this.signInType, use service type instead"},{name:"onSubmitCheckPinCode",docblock:null,modifiers:["async"],params:[{name:"el",type:null}],returns:null},{name:"checkExtraOptions",docblock:null,modifiers:[],params:[],returns:null},{name:"checkRenderExtra",docblock:null,modifiers:[],params:[],returns:null},{name:"loginWithoutPass",docblock:null,modifiers:["async"],params:[],returns:null},{name:"resetPass",docblock:null,modifiers:["async"],params:[],returns:null},{name:"goToPrevStep",docblock:null,modifiers:[],params:[],returns:null},{name:"renderErrorPasswordSuggestion",docblock:null,modifiers:[],params:[],returns:null},{name:"onSubmitPass",docblock:null,modifiers:["async"],params:[{name:"e",type:null}],returns:null},{name:"createGuestAccount",docblock:null,modifiers:["async"],params:[{name:"e",type:null}],returns:null},{name:"renderEnterEmailStep",docblock:null,modifiers:[],params:[],returns:null},{name:"getSubtext",docblock:null,modifiers:[],params:[],returns:null},{name:"renderEnterPasswordStep",docblock:null,modifiers:[],params:[],returns:null},{name:"renderCheckPin",docblock:null,modifiers:[],params:[{name:"resendAllowed",type:null},{name:"resendTimeoutProgress",type:null}],returns:null},{name:"renderGuest",docblock:null,modifiers:[],params:[],returns:null}],displayName:"SignInForm",props:{step:{defaultValue:{value:"SignInSteps.ENTER_MAIL",computed:!0},type:{name:"string"},required:!1,description:""},email:{type:{name:"string"},required:!1,description:""},phone:{type:{name:"string"},required:!1,description:""},name:{type:{name:"string"},required:!1,description:""},username:{type:{name:"string"},required:!1,description:""},signInType:{type:{name:"enum",value:[{value:"SignInTypes.EMAIL",computed:!0},{value:"SignInTypes.PHONE",computed:!0},{value:"SignInTypes.USERNAME",computed:!0}]},required:!1,description:""},password:{type:{name:"string"},required:!1,description:""},backUrl:{type:{name:"string"},required:!1,description:""},backAction:{type:{name:"func"},required:!1,description:""},guest:{type:{name:"bool"},required:!1,description:""},magicKey:{type:{name:"string"},required:!1,description:""},magicLinkKey:{type:{name:"string"},required:!1,description:""},isModal:{type:{name:"bool"},required:!1,description:""},signUpAllowed:{type:{name:"bool"},required:!1,description:""},loginWithoutPass:{type:{name:"bool"},required:!1,description:""},session:{type:{name:"object"},required:!1,description:""},setAuthEmail:{type:{name:"func"},required:!1,description:""},setAuthPhone:{type:{name:"func"},required:!1,description:""},setAuthPassword:{type:{name:"func"},required:!1,description:""},setAuthAllowedMods:{type:{name:"func"},required:!1,description:""},setAuthSignInType:{type:{name:"func"},required:!1,description:""},setAuthMode:{type:{name:"func"},required:!1,description:""},setAuthModalMode:{type:{name:"func"},required:!1,description:""},setAuthGuest:{type:{name:"func"},required:!1,description:""},setLoginServiceState:{type:{name:"func"},required:!1,description:""},setAuthName:{type:{name:"func"},required:!1,description:""},inviteLink:{type:{name:"object"},required:!1,description:""}},context:{history:{type:{name:"object"},required:!1},beansContext:{type:{name:"object"},required:!1}}};__webpack_exports__.default=Object(es.b)((function mapStateToProps(state){var authState=state.get(login_const.c);return authState?{email:authState.get("email"),phone:authState.get("phone"),username:authState.get("username"),signInType:authState.get("signInType"),name:authState.get("name"),backUrl:authState.get("backUrl"),backAction:authState.get("backAction"),guest:authState.get("guest"),magicKey:authState.get("magicKey"),magicLinkKey:authState.get("magicLinkKey"),isModal:authState.get("isModal"),signUpAllowed:authState.get("signUpAllowed"),loginWithoutPass:authState.get("loginWithoutPass"),session:state.get("session"),inviteLink:state.get("inviteLink")}:{}}),(function mapDispatchToProps(dispatch){return{setAuthEmail:function setAuthEmail(email){return dispatch(Object(loginServiceActions.w)(email))},setAuthPhone:function setAuthPhone(phone){return dispatch(Object(loginServiceActions.E)(phone))},setAuthPassword:function setAuthPassword(password){return dispatch(Object(loginServiceActions.D)(password))},setAuthAllowedMods:function setAuthAllowedMods(allowedMods){return dispatch(Object(loginServiceActions.t)(allowedMods))},setAuthSignInType:function setAuthSignInType(signInType){return dispatch(Object(loginServiceActions.G)(signInType))},setAuthMode:function setAuthMode(mode){return dispatch(Object(loginServiceActions.A)(mode))},setAuthModalMode:function setAuthModalMode(isModal){return dispatch(Object(loginServiceActions.z)(isModal))},setAuthGuest:function setAuthGuest(guest){return dispatch(Object(loginServiceActions.x)(guest))},setLoginServiceState:function setLoginServiceState(patch){return dispatch(Object(loginServiceActions.H)(patch))},setAuthName:function setAuthName(name){return dispatch(Object(loginServiceActions.C)(name))}}}))(Object(lib.withInject)(withStyles_default()(auth_default.a,login_default.a)(SignInForm_SignInForm)))}}]);